(e=>{let t,n,s,r,a,i,l,o;const c=[];let d,m=Promise.resolve();function h(e){return e?(o.addEventListener("keypress",E),o.addEventListener("submit",p),o.addEventListener("drop",g),n.addEventListener("click",L),s.addEventListener("click",f),r.addEventListener("click",v),Chat.show().then(()=>{Utils.sendEvent("chatView:shown"),C(),a.focus()})):(o.removeEventListener("keypress",E),n.removeEventListener("click",L),s.removeEventListener("click",f),r.removeEventListener("click",v),o.removeEventListener("drop",g),Chat.hide().then(()=>{Utils.sendEvent("chatView:hidden")}))}function u(e){d={incomingMessage:{name:"chatController:incomingMessage",handler(e){const t=e.detail.data;!function(e){const t=HTMLElems.createElementAt(l,"li"),n=HTMLElems.createElementAt(t,"p");if(otHelper.isMyself({connectionId:e.senderId}))t.classList.add("yourself");else{let t=c.indexOf(e.senderId);-1===t&&(t=c.push(e.senderId)-1);const s=t.toString().slice(-1);n.data("participant-number",s)}const s=e.time.toLowerCase();HTMLElems.createElementAt(n,"span",null,s).classList.add("time"),HTMLElems.createElementAt(n,"span",null,e.sender||e.userName).classList.add("sender"),y(n,e.text),C()}(t),m.then(()=>Chat.visible).then(e=>{e||Utils.sendEvent("chatView:unreadMessage",{data:t})})}},presenceEvent:{name:"chatController:presenceEvent",handler(e){!function(e){const t=(e.time||Utils.getCurrentTime()).toLowerCase(),n=HTMLElems.createElementAt(l,"li");n.classList.add("event");const s=e.sender||e.userName,r=`${t} - ${s} ${e.text}`;y(n,r),C()}(e.detail)}},messageDelivered:{name:"chatController:messageDelivered",handler(){a.value=""}},chatVisibility:{name:"roomView:chatVisibility",handler(e){m=h(e.detail)},couldBeChanged:!0}},Array.isArray(e)&&e.forEach(e=>{const t=d[e.type];t&&t.couldBeChanged&&(t.name=e.name)}),Utils.addHandlers(d)}const v=e=>{e.preventDefault(),a.value.trim().length&&(void 0!==window.orientation?document.activeElement.blur():a.focus(),Utils.sendEvent("chatView:outgoingMessage",{sender:t,time:Utils.getCurrentTime(),text:a.value.trim()}))},E=((e,t)=>{let n;if(window.vent)n=window.event.keyCode;else{if(!t)return!0;n=t.which}return 13!==n||(!0===t.shiftKey||(v(t),!1))}).bind(void 0,a),p=e=>(e.preventDefault(),!1),L=e=>{e.preventDefault(),e.stopImmediatePropagation(),m=h(!1)},f=()=>{Chat.isCollapsed()?Chat.expand():Chat.collapse()},g=e=>(e.preventDefault(),e.stopPropagation(),!1);function y(e,t){const n=TextProcessor.parse(t),s=HTMLElems.createElementAt(e,"p");n.forEach(e=>{switch(e.type){case TextProcessor.TYPE.URL:HTMLElems.createElementAt(s,"a",{href:e.value,target:"_blank"},e.value);break;default:HTMLElems.addText(s,e.value)}})}function C(){i.scrollTop=i.scrollHeight}const w={init:function(e,c){return LazyLoader.dependencyLoad(["/js/helpers/textProcessor.js","/js/components/chat.js"]).then(()=>{!function(){const e=document.getElementById("chat");s=e.querySelector("header"),n=e.querySelector("#closeChat"),r=e.querySelector("#sendTxt"),a=e.querySelector("#msgText"),i=e.querySelector("#chatMsgs"),l=i.querySelector("ul"),o=e.querySelector("#chatForm")}(),t=e,Chat.init(),u(c)})}};e.ChatView=w})(this);