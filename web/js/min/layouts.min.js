"use strict";var LayoutBase=function(t,e,a){this.items=e,(this.container=t).data("currentLayoutType",a)};LayoutBase.prototype={rearrange:function(){var a=this.features;return Object.keys(this.items).forEach(function(t){var e=this.items[t].style;Object.keys(a).forEach(function(t){e[t]=a[t]})},this),this.flush(),Utils.sendEvent("hangout:rearranged"),this},get features(){return{}},get total(){return Object.keys(this.items).length},flush:function(){HTMLElems.flush(this.container)},destroy:function(){this.container=null}};var Grid=function(t,e){LayoutBase.call(this,t,e,"grid")};Grid.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get:function(){var t=this.total,e=Math.ceil(Math.sqrt(t));return{width:100/e+"%",height:100/Math.ceil(t/e)+"%"}}}}),Grid.prototype.constructor=Grid;var Float=function(t,e){LayoutBase.call(this,t,e,"float"),this.addDraggableFeature()};Float.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get:function(){return{width:"100%",height:"100%"}}},publisher:{configurable:!1,get:function(){return this.items.publisher}}}),(Float.prototype.constructor=Float).prototype.addDraggableFeature=function(){!this.addedDraggableFeature&&this.publisher&&(this.addedDraggableFeature=!0,Utils.getDraggable().then(function(t){t.on(this.publisher)}.bind(this)))},Float.prototype.rearrange=function(){LayoutBase.prototype.rearrange.apply(this,arguments),this.addDraggableFeature()},Float.prototype.destroy=function(){Utils.getDraggable().then(function(t){t.off(this.publisher),LayoutBase.prototype.destroy.apply(this,arguments)}.bind(this))};var F2FHorizontal=function(t,e){LayoutBase.call(this,t,e,"f2f_horizontal")};F2FHorizontal.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get:function(){return{width:"100%",height:100/this.total+"%"}}}}),F2FHorizontal.prototype.constructor=F2FHorizontal;var F2FVertical=function(t,e){LayoutBase.call(this,t,e,"f2f_vertical")};F2FVertical.prototype=Object.create(LayoutBase.prototype,{features:{configurable:!1,get:function(){return{width:100/this.total+"%",height:"100%"}}}}),F2FVertical.prototype.constructor=F2FVertical;var Hangout=function(t,e,a,o){LayoutBase.call(this,t,e,o),Object.keys(this.handlers).forEach(function(t){window.addEventListener(t,this)},this),this.sanitize(!!a),a?this.putItemOnStage(a):this.totalOnStage||this.putItemOnStage(this.getRandomItem()),this.updateTotalOnStage()};Hangout.getAttributeName=function(t){return"onStage"+t.charAt(0).toUpperCase()+t.slice(1)},Hangout.getItemType=function(t){var e=null;switch(t.data("streamType")){case"camera":case"publisher":e="camera";break;default:e="screen"}return e},Hangout.getItemId=function(t){return t.data("id")},Hangout.stageTypeDescriptors=["camera","screen"].map(function(t){return{type:t,attrName:Hangout.getAttributeName(t)}}),Hangout.prototype=Object.create(LayoutBase.prototype,{stageIds:{configurable:!1,get:function(){var a={};return Hangout.stageTypeDescriptors.forEach(function(t){var e=this.container.data(t.attrName);e&&(a[t.type]=e)},this),a},set:function(e){e=e||{},Hangout.stageTypeDescriptors.forEach(function(t){e[t.type]?this.container.data(t.attrName,e[t.type]):this.container.data(t.attrName,null)},this)}},totalOnStage:{configurable:!1,get:function(){return Object.keys(this.stageIds).length}},totalOnStrip:{configurable:!1,get:function(){return this.total-this.totalOnStage}}}),(Hangout.prototype.constructor=Hangout).prototype.handlers={"layoutView:itemSelected":function(t){var e=t.detail.item;this.isOnStage(e)?this.removeCurrentItemFromStage("camera"===Hangout.getItemType(e)?"screen":"camera"):this.putItemOnStage(e),this.updateTotalOnStage()},"layoutManager:itemDeleted":function(t){var e=t.detail.item;this.isOnStage(e)&&(this.removeItemFromStage(e).updateTotalOnStage(),this.totalOnStage||Utils.sendEvent("hangout:emptyStage"))},"layoutManager:itemAdded":function(t){var e=t.detail.item;"screen"!==Hangout.getItemType(e)||this.stageIds.screen||this.putItemOnStage(e).updateTotalOnStage()}},Hangout.prototype.handleEvent=function(t){this.handlers[t.type].call(this,t)},Hangout.prototype.putItemOnStage=function(t){if(!t)return this;var e=Hangout.getItemType(t);return this.removeCurrentItemFromStage(e).putStageId(t),t.classList.add("on-stage"),"screen"===e&&Utils.sendEvent("hangout:screenOnStage",{status:"on"}),this},Hangout.prototype.getRandomItem=function(){return this.items[Object.keys(this.items).find(function(t){return"publisher"!==t})]},Hangout.prototype.removeCurrentItemFromStage=function(t){var e=this.items[this.stageIds[t]];return this.removeItemFromStage(e)},Hangout.prototype.removeItemFromStage=function(t){return t&&(this.removeStageId(t),t.classList.remove("on-stage"),"screen"===Hangout.getItemType(t)&&Utils.sendEvent("hangout:screenOnStage",{status:"off"})),this},Hangout.prototype.isOnStage=function(t){return t.classList.contains("on-stage")},Hangout.prototype.sanitize=function(t){var o,n={};return Array.prototype.forEach.call(this.container.querySelectorAll(".on-stage"),function(t){t.classList.remove("on-stage")}),t||(o=this.stageIds,Object.keys(o).forEach(function(t){var e=o[t],a=this.items[e];a&&(a.classList.add("on-stage"),n[t]=e)},this)),this.stageIds=n,this},Hangout.prototype.putStageId=function(t){var e=this.stageIds;return e[Hangout.getItemType(t)]=Hangout.getItemId(t),this.stageIds=e,this},Hangout.prototype.removeStageId=function(t){var e=this.stageIds;return delete e[Hangout.getItemType(t)],this.stageIds=e,this},Hangout.prototype.updateTotalOnStage=function(){return this.container.data("totalOnStage",this.totalOnStage),this.rearrange()},Hangout.prototype.destroy=function(){Object.keys(this.handlers).forEach(function(t){window.removeEventListener(t,this)},this),LayoutBase.prototype.destroy.apply(this,arguments)};var HangoutHorizontal=function(t,e,a){Hangout.call(this,t,e,a,"hangout_horizontal")};HangoutHorizontal.prototype=Object.create(Hangout.prototype,{features:{configurable:!1,get:function(){return{width:100/this.totalOnStrip+"%",height:"100%"}}}}),HangoutHorizontal.prototype.constructor=HangoutHorizontal;var HangoutVertical=function(t,e,a){Hangout.call(this,t,e,a,"hangout_vertical")};HangoutVertical.prototype=Object.create(Hangout.prototype,{features:{configurable:!1,get:function(){return{width:"100%",height:100/this.totalOnStrip+"%"}}}}),HangoutVertical.prototype.constructor=HangoutVertical;