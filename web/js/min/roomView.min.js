(e=>{let t,o,n,i,a,s,l,d,c,r,u,m,g,h,v,y,b,p,w,E,L,k,f=!1,S=!1,C=0,V=!1,M=!1;const U={mute:{head:"Mute all participants, including yourself",detail:'Everyone will be notified and can click their <i data-icon="no_mic"></i> button to unmute themselves.',button:"Mute all participants"},muteRemotely:{head:"All participants microphones are being disabled in the call",detail:"If you want to keep talking, you must manually enable your own microphone.",button:"I understand"},unmutedRemotely:{head:"Your microphone is now enabled in the call",detail:"If you want to remain muted, you must manually disable your own microphone.",button:"I understand"},join:{head:"All participants are muted",detail:"You can unmute everyone by toggling the Mute all participants option. Or you can unmute just yourself by clicking the microphone icon in the bottom menu.",button:"I understand"},lock:{head:"Do you want to lock the meeting?",detail:"When a meeting room is locked, no one else will be allowed to join the meeting. Current participants who leave the meeting will not be allowed back in.",button:"Lock Meeting"},endCall:{head:"Do you want to leave the meeting?",detail:"The meeting will continue with the remaining participants.",button:"Leave meeting"},endLockedCall:{head:"Do you want to unlock the meeting before leaving?",detail:"The meeting will continue with the remaining participants. When a meeting room is locked, no one else will be allowed to join or re-join the meeting.",button:"Unlock and Leave",altButton:"Leave Without Unlocking"},sessionDisconnected:{head:"Session disconected",detail:"The connection to the OpenTok platform has been lost. Check your network connectivity and press Reload to connect again.",button:"Reload"},chromePublisherError:{head:"Internal Chrome Error",detail:"Failed to acquire microphone. This is a known Chrome bug. Please completely quit and restart your browser.",button:"Reload"},meetingFullError:{head:"Meeting Full",detail:`This meeting has reached the full capacity of ${maxUsersPerRoom} participants. Try&nbsp;joining later.`,button:"OK"}};function B(e){M||(C=e,p.textContent=0===e?"":`(${e})`)}function R(e){M=e,e?(V=!0,B(0),u.classList.add("activated"),window.innerWidth<=480&&j()):u.classList.remove("activated"),Utils.sendEvent("roomView:chatVisibility",e),HTMLElems.flush("#toggleChat")}const I={unreadMessage(){V||R(!0),B(C+1)},hidden(){Utils.sendEvent("roomView:screenChange")},shown(){Utils.sendEvent("roomView:screenChange")}},T={hidden(){document.body.data("chatStatus","hidden"),u.classList.remove("activated"),B(0),HTMLElems.flush("#toggleChat")}},A={screenOnStage(e){"on"===e.detail.status?(t.data("previouslyCollapsed",t.classList.contains("collapsed")),t.classList.add("collapsed")):null!==t.data("previouslyCollapsed")&&("true"===t.data("previouslyCollapsed")?t.classList.add("collapsed"):t.classList.remove("collapsed"),t.data("previouslyCollapsed",null))},rearranged(){Utils.sendEvent("roomView:screenChange")}},D={changeScreenShareStatus:$,destroyed:$.bind(void 0,{detail:{isSharing:!1}}),annotationStarted(){Utils.setDisabled(c,!1)},annotationEnded(){document.body.data("annotationVisible","false"),Utils.setDisabled(c,!0)}},H={userChangeStatus(e){"video"===e.detail.name?O(!1,!1,h,"roomView:videoSwitch"):"audio"===e.detail.name&&O(!1,!1,v,"roomView:muteAllSwitch")},roomLocked(e){const t=e.detail;RoomView.lockState=t;const o=document.getElementById("lock-room-icon"),n=document.getElementById("lock-msg"),i=document.getElementById("room-locked-state");"locked"===t&&(n.innerHTML="Unlock Meeting",o.setAttribute("data-icon","closedLock"),i.style.display="block"),"unlocked"===t&&(n.innerHTML="Lock Meeting",o.setAttribute("data-icon","openLock"),i.style.display="none",Modal.flashMessage(".room-unlocked-modal"))},roomMuted(e){const t=e.detail.isJoining;q(!0),Modal.showConfirm(t?U.join:U.muteRemotely)},sessionDisconnected(){RoomView.participantsNumber=0,LayoutManager.removeAll()},controllersReady(){const e=document.querySelectorAll("#top-banner [disabled], .call-controls [disabled]:not(#toggle-publisher-video):not(#toggle-publisher-audio):not(#annotate)");Array.prototype.forEach.call(e,e=>{Utils.setDisabled(e,!1)})},annotationStarted(){Utils.setDisabled(c,!1)},annotationEnded(){document.body.data("annotationVisible","false"),Utils.setDisabled(c,!0)},chromePublisherError(){Modal.showConfirm(U.chromePublisherError).then(()=>{document.location.reload()})},meetingFullError(){Modal.showConfirm(U.meetingFullError).then(()=>{document.location.reload()})}};function q(e){O(e,!1,v,"roomView:muteAllSwitch"),x(e?"muted":"activated")}function F(){t=document.getElementById("top-banner"),o=t,n=document.querySelector(".call-controls"),i=document.querySelector(".feedbackButton"),m=document.getElementById("participantsStr"),g=t.querySelector("#recordings"),h=t.querySelector("#videoSwitch"),v=t.querySelector("#audioSwitch"),p=document.getElementById("unreadCount"),s=document.getElementById("toggle-publisher-audio"),a=document.getElementById("toggle-publisher-video"),l=document.getElementById("startArchiving"),d=document.getElementById("stopArchiving"),c=document.getElementById("annotate"),r=document.getElementById("manageRecordings"),u=document.getElementById("message-btn"),y=document.getElementById("top-banner"),b=document.getElementById("screen")}function P(){n.classList.add("visible"),f||L||(L=setTimeout(j,3e3)),function(){if(!i)return;i.classList.add("visible"),S||k||(k=setTimeout(N,3e3))}()}function j(){L=null,n.classList.remove("visible")}function N(){k=null,i.classList.remove("visible")}function O(e,t,o,n){const i=o.classList.contains("activated");let a;void 0===e?a=o.classList.toggle("activated"):(a=e,e?o.classList.add("activated"):o.classList.remove("activated")),t&&a!==i&&Utils.sendEvent(n,{status:a})}function x(e){"activated"===e?(s.classList.add("activated"),s.querySelector("i").data("icon","mic")):(s.classList.remove("activated"),s.querySelector("i").data("icon","mic-muted"))}let W=null;function _(){return W?Promise.resolve(W):LazyLoader.dependencyLoad(["/js/components/cronograph.js"]).then(()=>(W=Cronograph,W))}const Y=()=>{o.addEventListener("click",()=>{t.classList.toggle("collapsed"),t.data("previouslyCollapsed",null)}),n.addEventListener("click",e=>{let t=e.target;if(t=HTMLElems.getAncestorByTagName(t,"button"),null!==t)switch(t.id){case"addToCall":Utils.sendEvent("roomView:addToCall");break;case"toggle-publisher-video":{let e;t.classList.contains("activated")?(t.classList.remove("activated"),t.querySelector("i").data("icon","no_video"),e=!1):(t.classList.add("activated"),t.querySelector("i").data("icon","video_icon"),e=!0),Utils.sendEvent("roomView:togglePublisherVideo",{hasVideo:e});break}case"toggle-publisher-audio":{let e;t.classList.contains("activated")?(t.classList.remove("activated"),t.querySelector("i").data("icon","mic-muted"),e=!1):(t.classList.add("activated"),t.querySelector("i").data("icon","mic"),e=!0),Utils.sendEvent("roomView:togglePublisherAudio",{hasAudio:e});break}case"screen-share":Utils.sendEvent("roomView:shareScreen");break;case"annotate":"true"===document.body.data("annotationVisible")?document.body.data("annotationVisible","false"):document.body.data("annotationVisible","true"),Utils.sendEvent("roomView:screenChange");break;case"message-btn":R(!u.classList.contains("activated"));break;case"endCall":"locked"===RoomView.lockState?Modal.showConfirm(U.endLockedCall).then(e=>{e.altHasAccepted?(RoomView.participantsNumber=0,Utils.sendEvent("roomView:endCall")):e&&(Utils.sendEvent("roomView:setRoomLockState","unlocked"),setTimeout(()=>{RoomView.participantsNumber=0,Utils.sendEvent("roomView:endCall")},3e3))}):Modal.showConfirm(U.endCall).then(e=>{e&&(RoomView.participantsNumber=0,Utils.sendEvent("roomView:endCall"))})}});if(document.getElementById("top-icons-container").addEventListener("click",()=>{BubbleFactory.get("chooseLayout").hide()}),window.enableRoomLocking){document.getElementById("lockRoomContainer").addEventListener("click",()=>{const e=document.getElementById("lock-room-icon").getAttribute("data-icon");"openLock"===e&&Modal.showConfirm(U.lock).then(e=>{e&&Utils.sendEvent("roomView:setRoomLockState","locked")}),"closedLock"===e&&Utils.sendEvent("roomView:setRoomLockState","unlocked")})}document.getElementById("pickMicContainer").addEventListener("click",()=>{const e=document.getElementById("select-devices");e.style.display="inline-block",Modal.showConfirm({head:"Set mic input",detail:"Please identify the audio source in the following list:",button:"Change"}).then(t=>{t&&Utils.sendEvent("roomView:setAudioSource",e.value),e.style.display="none"})});document.getElementById("pickCamContainer").addEventListener("click",()=>{Utils.sendEvent("roomView:toggleFacingMode")});if(document.getElementById("top-banner").addEventListener("click",e=>{const t=HTMLElems.getAncestorByTagName(e.target,"a")||e.target;if(t.blur(),t)switch(t.id){case"viewRecordings":BubbleFactory.get("viewRecordings").toggle();break;case"options-container":case"chooseLayout":BubbleFactory.get("chooseLayout").toggle();break;case"startArchiving":case"stopArchiving":Utils.sendEvent("roomView:"+t.id);break;case"startChat":case"stopChat":R("startChat"===t.id);break;case"addToCall":Utils.sendEvent("roomView:addToCall");break;case"startSharingDesktop":case"stopSharingDesktop":Utils.sendEvent("roomView:shareScreen");break;case"videoSwitch":h.classList.contains("activated")?O(!1,!0,h,"roomView:videoSwitch"):O(!0,!0,h,"roomView:videoSwitch");break;case"audioSwitch":v.classList.contains("activated")?(O(!1,!0,v,"roomView:muteAllSwitch"),s.classList.add("activated")):Modal.showConfirm(U.mute).then(e=>{e&&(O(!0,!0,v,"roomView:muteAllSwitch"),s.classList.remove("activated"))})}}),E){document.getElementById("dialOutBtn").addEventListener("click",e=>{e.preventDefault(),Utils.sendEvent("roomView:verifyDialOut")}),Utils.addEventsHandlers("phoneNumberView:",{dialOut(e){const t=e.detail;Utils.sendEvent("roomView:dialOut",t)}})}e.addEventListener("archiving",t=>{const o=t.detail;switch(o.status){case"started":n=o,_().then(t=>{const o=e=>{let o=0;e&&(o=Math.round((Date.now()-e.createdAt)/1e3)),t.start(o),l.style.display="none",d.style.display="block",r.classList.add("recording")};if(!w)return t.init(),o(null);const i=()=>{const e=FirebaseModel.archives,t=n.id;if(e)return o(e[t]);FirebaseModel.addEventListener("value",(function e(n){FirebaseModel.removeEventListener("value",e),o(n[t])}))},a=RecordingsController.model;if(a)return t.init(),i();t.init("Recording"),e.addEventListener("recordings-model-ready",(function t(){e.removeEventListener("recordings-model-ready",t),i(RecordingsController.model)}))});break;case"stopped":_().then(e=>{d.style.display="none",l.style.display="inline-block",r.classList.remove("recording"),e.stop()})}var n;document.body.data("archiveStatus",t.detail.status),HTMLElems.flush(["#toggleArchiving",'[data-stream-type=publisher] [data-icon="record"]'])}),Utils.addEventsHandlers("screenShareController:",D,e),Utils.addEventsHandlers("roomController:",H,e),Utils.addEventsHandlers("chat:",T),Utils.addEventsHandlers("chatView:",I),Utils.addEventsHandlers("hangout:",A)};function $(e){const t=e.detail.isSharing;document.body.data("desktopStatus",t?"sharing":"notSharing"),HTMLElems.flush("#toggleSharing")}e.RoomView={init:(e,o,n)=>{w=o,F(),t.style.visibility="visible",E=n,Y(),(()=>{const e=document.getElementById("current-url"),t=window.location.origin+window.location.pathname;e.innerHTML=t})(),LayoutManager.init(".streams",e)},set participantsNumber(e){HTMLElems.replaceText(m,e),window.enableRoomLocking&&(1===e&&"locked"!==RoomView.lockState?document.getElementById("lockRoomContainer").style.display="none":document.getElementById("lockRoomContainer").style.removeProperty("display"),1===e&&"locked"===RoomView.lockState&&(Utils.sendEvent("roomView:setRoomLockState","unlocked"),document.getElementById("lockRoomContainer").style.display="none"))},set recordingsNumber(e){r&&(0===e?(r.style.display="none",document.getElementById("toggleArchiving").classList.remove("manage-recordings")):(r.style.display="block",g&&(g.textContent=e),document.getElementById("toggleArchiving").classList.add("manage-recordings")))},showRoom:function(){F(),y.style.visibility="visible",b.style.visibility="visible",b.addEventListener("mousemove",P),n.addEventListener("mouseover",()=>{clearTimeout(L),f=!0}),n.addEventListener("mouseout",()=>{f=!1,j()}),i&&i.addEventListener("mouseover",()=>{clearTimeout(k),S=!0}),i&&i.addEventListener("mouseout",()=>{S=!1,N()})},showPublisherButtons:function(e){Utils.setDisabled(a,!1),Utils.setDisabled(s,!1),e.publishVideo&&(a.classList.add("activated"),a.querySelector("i").data("icon","video_icon")),e.publishAudio&&x("activated")},createStreamView:function(e,t,o,n){return LayoutManager.append(e,t,o,n)},deleteStreamView:function(e){LayoutManager.remove(e)},setAudioSwitchRemotely:q,showConfirmChangeMicStatus:function(e){return Modal.showConfirm(e?U.muteRemotely:U.unmutedRemotely)}}})(this);