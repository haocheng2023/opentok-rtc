!function(a){"use strict";var s,e,t,n,o,i,l,d,c,r,u,m,g,h,v,y,b,p,f,w,E,L,k=!1,S=!1,C=0,V=!1,M=!1,U={mute:{head:"Mute all participants, including yourself",detail:'Everyone will be notified and can click their <i data-icon="no_mic"></i> button to unmute themselves.',button:"Mute all participants"},muteRemotely:{head:"All participants microphones are being disabled in the call",detail:"If you want to keep talking, you must manually enable your own microphone.",button:"I understand"},unmutedRemotely:{head:"Your microphone is now enabled in the call",detail:"If you want to remain muted, you must manually disable your own microphone.",button:"I understand"},join:{head:"All participants are muted",detail:"You can unmute everyone by toggling the Mute all participants option. Or you can unmute just yourself by clicking the microphone icon in the bottom menu.",button:"I understand"},lock:{head:"Do you want to lock the meeting?",detail:"When a meeting room is locked, no one else will be allowed to join the meeting. Current participants who leave the meeting will not be allowed back in.",button:"Lock Meeting"},endCall:{head:"Do you want to leave the meeting?",detail:"The meeting will continue with the remaining participants.",button:"Leave meeting"},endLockedCall:{head:"Do you want to unlock the meeting before leaving?",detail:"The meeting will continue with the remaining participants. When a meeting room is locked, no one else will be allowed to join or re-join the meeting.",button:"Unlock and Leave",altButton:"Leave Without Unlocking"},sessionDisconnected:{head:"Session disconected",detail:"The connection to the OpenTok platform has been lost. Check your network connectivity and press Reload to connect again.",button:"Reload"},chromePublisherError:{head:"Internal Chrome Error",detail:"Failed to acquire microphone. This is a known Chrome bug. Please completely quit and restart your browser.",button:"Reload"},meetingFullError:{head:"Meeting Full",detail:"This meeting has reached the full capacity of "+maxUsersPerRoom+" participants. Try&nbsp;joining later.",button:"OK"}};function B(e){M||(C=e,p.textContent=0===e?"":"("+e+")")}function R(e){(M=e)?(V=!0,B(0),u.classList.add("activated"),window.innerWidth<=480&&j()):u.classList.remove("activated"),Utils.sendEvent("roomView:chatVisibility",e),HTMLElems.flush("#toggleChat")}var I={unreadMessage:function(){V||R(!0),B(C+1)},hidden:function(){Utils.sendEvent("roomView:screenChange")},shown:function(){Utils.sendEvent("roomView:screenChange")}},T={hidden:function(){document.body.data("chatStatus","hidden"),u.classList.remove("activated"),B(0),HTMLElems.flush("#toggleChat")}},A={screenOnStage:function(e){"on"===e.detail.status?(s.data("previouslyCollapsed",s.classList.contains("collapsed")),s.classList.add("collapsed")):null!==s.data("previouslyCollapsed")&&("true"===s.data("previouslyCollapsed")?s.classList.add("collapsed"):s.classList.remove("collapsed"),s.data("previouslyCollapsed",null))},rearranged:function(){Utils.sendEvent("roomView:screenChange")}},D={changeScreenShareStatus:J,destroyed:J.bind(void 0,{detail:{isSharing:!1}}),annotationStarted:function(){Utils.setDisabled(c,!1)},annotationEnded:function(){document.body.data("annotationVisible","false"),Utils.setDisabled(c,!0)}},H={userChangeStatus:function(e){"video"===e.detail.name?O(!1,!1,h,"roomView:videoSwitch"):"audio"===e.detail.name&&O(!1,!1,v,"roomView:muteAllSwitch")},roomLocked:function(e){var t=e.detail;RoomView.lockState=t;var n=document.getElementById("lock-room-icon"),o=document.getElementById("lock-msg"),i=document.getElementById("room-locked-state");"locked"===t&&(o.innerHTML="Unlock Meeting",n.setAttribute("data-icon","closedLock"),i.style.display="block"),"unlocked"===t&&(o.innerHTML="Lock Meeting",n.setAttribute("data-icon","openLock"),i.style.display="none",Modal.flashMessage(".room-unlocked-modal"))},roomMuted:function(e){var t=e.detail.isJoining;q(!0),Modal.showConfirm(t?U.join:U.muteRemotely)},sessionDisconnected:function(){RoomView.participantsNumber=0,LayoutManager.removeAll()},controllersReady:function(){var e=document.querySelectorAll("#top-banner [disabled], .call-controls [disabled]:not(#toggle-publisher-video):not(#toggle-publisher-audio):not(#annotate)");Array.prototype.forEach.call(e,function(e){Utils.setDisabled(e,!1)})},annotationStarted:function(){Utils.setDisabled(c,!1)},annotationEnded:function(){document.body.data("annotationVisible","false"),Utils.setDisabled(c,!0)},chromePublisherError:function(){Modal.showConfirm(U.chromePublisherError).then(function(){document.location.reload()})},meetingFullError:function(){Modal.showConfirm(U.meetingFullError).then(function(){document.location.reload()})}};function q(e){O(e,!1,v,"roomView:muteAllSwitch"),x(e?"muted":"activated")}function F(){s=document.getElementById("top-banner"),e=s,t=document.querySelector(".call-controls"),n=document.querySelector(".feedbackButton"),m=document.getElementById("participantsStr"),g=s.querySelector("#recordings"),h=s.querySelector("#videoSwitch"),v=s.querySelector("#audioSwitch"),p=document.getElementById("unreadCount"),i=document.getElementById("toggle-publisher-audio"),o=document.getElementById("toggle-publisher-video"),l=document.getElementById("startArchiving"),d=document.getElementById("stopArchiving"),c=document.getElementById("annotate"),r=document.getElementById("manageRecordings"),u=document.getElementById("message-btn"),y=document.getElementById("top-banner"),b=document.getElementById("screen")}function P(){t.classList.add("visible"),k||E||(E=setTimeout(j,3e3)),function(){if(!n)return;n.classList.add("visible"),S||L||(L=setTimeout(N,3e3))}()}function j(){E=null,t.classList.remove("visible")}function N(){L=null,n.classList.remove("visible")}function O(e,t,n,o){var i,a=n.classList.contains("activated");void 0===e?i=n.classList.toggle("activated"):(i=e)?n.classList.add("activated"):n.classList.remove("activated"),t&&i!==a&&Utils.sendEvent(o,{status:i})}function x(e){"activated"===e?(i.classList.add("activated"),i.querySelector("i").data("icon","mic")):(i.classList.remove("activated"),i.querySelector("i").data("icon","mic-muted"))}var W=null;function _(){return W?Promise.resolve(W):LazyLoader.dependencyLoad(["/js/components/cronograph.js"]).then(function(){return W=Cronograph})}function Y(i){_().then(function(n){function o(e){var t=0;e&&(t=Math.round((Date.now()-e.createdAt)/1e3)),n.start(t),l.style.display="none",d.style.display="block",r.classList.add("recording")}if(!f)return n.init(),o(null);function t(){var e=FirebaseModel.archives,n=i.id;if(e)return o(e[n]);FirebaseModel.addEventListener("value",function e(t){FirebaseModel.removeEventListener("value",e),o(t[n])})}var e=RecordingsController.model;if(e)return n.init(),t();n.init("Recording"),a.addEventListener("recordings-model-ready",function e(){a.removeEventListener("recordings-model-ready",e),t(RecordingsController.model)})})}function z(){e.addEventListener("click",function(){s.classList.toggle("collapsed"),s.data("previouslyCollapsed",null)}),t.addEventListener("click",function(e){var t=e.target;if(null!==(t=HTMLElems.getAncestorByTagName(t,"button")))switch(t.id){case"addToCall":Utils.sendEvent("roomView:addToCall");break;case"toggle-publisher-video":var n=t.classList.contains("activated")?(t.classList.remove("activated"),t.querySelector("i").data("icon","no_video"),!1):(t.classList.add("activated"),t.querySelector("i").data("icon","video_icon"),!0);Utils.sendEvent("roomView:togglePublisherVideo",{hasVideo:n});break;case"toggle-publisher-audio":var o=t.classList.contains("activated")?(t.classList.remove("activated"),t.querySelector("i").data("icon","mic-muted"),!1):(t.classList.add("activated"),t.querySelector("i").data("icon","mic"),!0);Utils.sendEvent("roomView:togglePublisherAudio",{hasAudio:o});break;case"screen-share":Utils.sendEvent("roomView:shareScreen");break;case"annotate":"true"===document.body.data("annotationVisible")?document.body.data("annotationVisible","false"):document.body.data("annotationVisible","true"),Utils.sendEvent("roomView:screenChange");break;case"message-btn":R(!u.classList.contains("activated"));break;case"endCall":"locked"===RoomView.lockState?Modal.showConfirm(U.endLockedCall).then(function(e){e.altHasAccepted?(RoomView.participantsNumber=0,Utils.sendEvent("roomView:endCall")):e&&(Utils.sendEvent("roomView:setRoomLockState","unlocked"),setTimeout(function(){RoomView.participantsNumber=0,Utils.sendEvent("roomView:endCall")},3e3))}):Modal.showConfirm(U.endCall).then(function(e){e&&(RoomView.participantsNumber=0,Utils.sendEvent("roomView:endCall"))})}}),document.getElementById("top-icons-container").addEventListener("click",function(e){BubbleFactory.get("chooseLayout").hide()}),enableRoomLocking&&document.getElementById("lockRoomContainer").addEventListener("click",function(e){var t=document.getElementById("lock-room-icon").getAttribute("data-icon");"openLock"==t&&Modal.showConfirm(U.lock).then(function(e){e&&Utils.sendEvent("roomView:setRoomLockState","locked")}),"closedLock"==t&&Utils.sendEvent("roomView:setRoomLockState","unlocked")}),document.getElementById("pickMicContainer").addEventListener("click",function(e){var t=document.getElementById("select-devices");t.style.display="inline-block",Modal.showConfirm({head:"Set mic input",detail:"Please identify the audio source in the following list:",button:"Change"}).then(function(e){e&&Utils.sendEvent("roomView:setAudioSource",t.value),t.style.display="none"})}),document.getElementById("pickCamContainer").addEventListener("click",function(e){Utils.sendEvent("roomView:toggleFacingMode")}),document.getElementById("top-banner").addEventListener("click",function(e){var t=HTMLElems.getAncestorByTagName(e.target,"a")||e.target;if(t.blur(),t)switch(t.id){case"viewRecordings":BubbleFactory.get("viewRecordings").toggle();break;case"options-container":case"chooseLayout":BubbleFactory.get("chooseLayout").toggle();break;case"startArchiving":case"stopArchiving":Utils.sendEvent("roomView:"+t.id);break;case"startChat":case"stopChat":R("startChat"===t.id);break;case"addToCall":Utils.sendEvent("roomView:addToCall");break;case"startSharingDesktop":case"stopSharingDesktop":Utils.sendEvent("roomView:shareScreen");break;case"videoSwitch":h.classList.contains("activated")?O(!1,!0,h,"roomView:videoSwitch"):O(!0,!0,h,"roomView:videoSwitch");break;case"audioSwitch":v.classList.contains("activated")?(O(!1,!0,v,"roomView:muteAllSwitch"),i.classList.add("activated")):Modal.showConfirm(U.mute).then(function(e){e&&(O(!0,!0,v,"roomView:muteAllSwitch"),i.classList.remove("activated"))})}}),w&&(document.getElementById("dialOutBtn").addEventListener("click",function(e){e.preventDefault(),Utils.sendEvent("roomView:verifyDialOut")}),Utils.addEventsHandlers("phoneNumberView:",{dialOut:function(e){var t=e.detail;Utils.sendEvent("roomView:dialOut",t)}})),a.addEventListener("archiving",function(e){var t=e.detail;switch(t.status){case"started":Y(t);break;case"stopped":_().then(function(e){d.style.display="none",l.style.display="inline-block",r.classList.remove("recording"),e.stop()})}document.body.data("archiveStatus",e.detail.status),HTMLElems.flush(["#toggleArchiving",'[data-stream-type=publisher] [data-icon="record"]'])}),Utils.addEventsHandlers("screenShareController:",D,a),Utils.addEventsHandlers("roomController:",H,a),Utils.addEventsHandlers("chat:",T),Utils.addEventsHandlers("chatView:",I),Utils.addEventsHandlers("hangout:",A)}function J(e){var t=e.detail.isSharing;document.body.data("desktopStatus",t?"sharing":"notSharing"),HTMLElems.flush("#toggleSharing")}a.RoomView={init:function(e,t,n){var o,i;f=t,F(),s.style.visibility="visible",w=n,z(),o=document.getElementById("current-url"),i=window.location.origin+window.location.pathname,o.innerHTML=i,LayoutManager.init(".streams",e)},set participantsNumber(e){HTMLElems.replaceText(m,e),enableRoomLocking&&(1===e&&"locked"!==RoomView.lockState?document.getElementById("lockRoomContainer").style.display="none":document.getElementById("lockRoomContainer").style.removeProperty("display"),1===e&&"locked"===RoomView.lockState&&(Utils.sendEvent("roomView:setRoomLockState","unlocked"),document.getElementById("lockRoomContainer").style.display="none"))},set recordingsNumber(e){r&&(0===e?(r.style.display="none",document.getElementById("toggleArchiving").classList.remove("manage-recordings")):(r.style.display="block",g&&(g.textContent=e),document.getElementById("toggleArchiving").classList.add("manage-recordings")))},showRoom:function(){F(),y.style.visibility="visible",b.style.visibility="visible",b.addEventListener("mousemove",P),t.addEventListener("mouseover",function(){clearTimeout(E),k=!0}),t.addEventListener("mouseout",function(){k=!1,j()}),n&&n.addEventListener("mouseover",function(){clearTimeout(L),S=!0}),n&&n.addEventListener("mouseout",function(){S=!1,N()})},showPublisherButtons:function(e){Utils.setDisabled(o,!1),Utils.setDisabled(i,!1),e.publishVideo&&(o.classList.add("activated"),o.querySelector("i").data("icon","video_icon")),e.publishAudio&&x("activated")},createStreamView:function(e,t,n,o){return LayoutManager.append(e,t,n,o)},deleteStreamView:function(e){LayoutManager.remove(e)},setAudioSwitchRemotely:q,showConfirmChangeMicStatus:function(e){return Modal.showConfirm(e?U.muteRemotely:U.unmutedRemotely)}}}(this);